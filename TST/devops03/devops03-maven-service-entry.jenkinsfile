// æœ€ç®€å®ç° - ä½¿ç”¨ Extended Choice Parameter
def jobs = [
    'TST/devops03/devops03-maven-service-dockercompose',
    'TST/devops03/devops03-maven-service',
    'TST/devops03/devops03-maven-service-standard'
]

def all_jobs = jobs.join(',')

pipeline {
    agent any

     options {
        skipDefaultCheckout true
        timestamps()
    }


    parameters {
        // Extended Choice Parameter - å¤šé€‰å‚æ•°
        extendedChoice(
            name: 'DOWNSTREAM_JOBS',
            type: 'PT_CHECKBOX',
            value: all_jobs,
            defaultValue: all_jobs,  // è¿™é‡Œè®¾ç½®é»˜è®¤å…¨é€‰
            description: 'é€‰æ‹©è¦è§¦å‘çš„ä¸‹æ¸¸ä»»åŠ¡',
            multiSelectDelimiter: ',',
            visibleItemCount: 5
        )
        
        string 'releaseVersion'
    }
    
    stages {
        stage('è§¦å‘ä¸‹æ¸¸') {
            steps {
                script {
                    echo "ğŸš€ å¼€å§‹è§¦å‘ä¸‹æ¸¸ä»»åŠ¡"
                    
                    // å¤„ç†é€‰ä¸­çš„ä»»åŠ¡
                    def selectedJobs = params.DOWNSTREAM_JOBS.split(',').collect { it.trim() }
                    
                    echo "å·²é€‰æ‹© ${selectedJobs.size()} ä¸ªä»»åŠ¡ï¼š"
                    selectedJobs.each { job ->
                        echo "  â€¢ ${job}"
                    }
                    
                    // å¹¶è¡Œè§¦å‘
                    parallel selectedJobs.collectEntries { jobName ->
                        ["è§¦å‘ ${jobName}": {
                            echo "è§¦å‘: ${jobName}"
                            build job: jobName, wait: false
                        }]
                    }
                    
                    echo "âœ… æ‰€æœ‰ä»»åŠ¡å·²è§¦å‘"
                }
            }
        }
    }
}